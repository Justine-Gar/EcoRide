<div class="container">
  <div class="mb-3">
    <a href="{{ path('app_covoiturage', {'depart': depart, 'arrivee': arrivee, 'date': date}) }}" class="btn btn-outline-secondary">
      <i class="fas fa-arrow-left me-2"></i>Retour aux résultats
    </a>
  </div>
  
  <div class="row">
    <!-- Colonne gauche: infos du trajet -->
    <div class="col-md-8">
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Informations du trajet</h5>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <h6><i class="fas fa-map-marker-alt me-2 text-primary"></i>Départ</h6>
              <p>
                <strong>{{ selectedCarpool.locationStart }}</strong><br>
                Le {{ selectedCarpool.dateStart|date('d/m/Y') }} à {{ selectedCarpool.hourStart|date('H:i') }}
              </p>
            </div>
            <div class="col-md-6">
              <h6><i class="fas fa-flag-checkered me-2 text-success"></i>Arrivée</h6>
              <p>
                <strong>{{ selectedCarpool.locationReach }}</strong><br>
                Le {{ selectedCarpool.dateReach|date('d/m/Y') }} à {{ selectedCarpool.hourReach|date('H:i') }}
              </p>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <h6><i class="fas fa-users me-2"></i>Places disponibles</h6>
              <p>{{ selectedCarpool.nbrPlaces - selectedCarpool.passengers|length }} / {{ selectedCarpool.nbrPlaces }}</p>
            </div>
            <div class="col-md-6">
              <h6><i class="fas fa-coins me-2"></i>Prix</h6>
              <p>{{ selectedCarpool.credits }} crédits</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Liste des passagers -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Passagers ({{ selectedCarpool.passengers|length }}/{{ selectedCarpool.nbrPlaces }})</h5>
          
          {% if selectedCarpool.passengers|length > 0 %}
            <ul class="list-group">
              {% for passenger in selectedCarpool.passengers %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div class="passenger-info d-flex align-items-center">
                    {% if passenger.profilPicture %}
                      <img src="{{ asset('uploads/profile/' ~ passenger.profilPicture) }}" alt="Avatar" class="me-3 rounded-circle" width="40">
                    {% else %}
                      <img src="{{ asset('assets/images/default-profile.png') }}" alt="Avatar" class="me-3 rounded-circle" width="40">
                    {% endif %}
                    <span>{{ passenger.firstname }} {{ passenger.name }}</span>
                  </div>
                  <span class="badge bg-primary">Passager</span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted">Aucun passager inscrit pour le moment.</p>
          {% endif %}
        </div>
      </div>
    </div>
    
    <!-- Colonne droite: conducteur et actions -->
    <div class="col-md-4">
      <!-- Informations conducteur -->
      <div class="card mb-4">
        <div class="card-body text-center">
          <h5 class="card-title">Conducteur</h5>
          
          {% if selectedCarpool.user.profilPicture %}
            <img src="{{ asset('uploads/profile/' ~ selectedCarpool.user.profilPicture) }}" alt="Avatar" class="mb-3 rounded-circle" width="100">
          {% else %}
            <img src="{{ asset('assets/images/default-profile.png') }}" alt="Avatar" class="mb-3 rounded-circle" width="100">
          {% endif %}
          
          <h5>{{ selectedCarpool.user.firstname }} {{ selectedCarpool.user.name }}</h5>
          <div class="rating mb-3">
            <span class="rating-value">5,0</span>
            <span class="etoile">★</span>
          </div>
          
          {% if selectedCarpool.user.phoneNumber %}
            <p><i class="fas fa-phone me-2"></i>{{ selectedCarpool.user.phoneNumber }}</p>
          {% endif %}
        </div>
      </div>
      
      <!-- Actions -->
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Actions</h5>
          
          {% if app.user %}
            {% if app.user.idUser == selectedCarpool.user.idUser %}
              <!-- Conducteur -->
              {% if selectedCarpool.statut == 'actif' %}
                <a href="{{ path('app_covoiturage_cancel', {'id': selectedCarpool.idCarpool}) }}" 
                  class="btn btn-danger d-block mb-3" 
                  onclick="return confirm('Êtes-vous sûr de vouloir annuler ce trajet ?')">
                  <i class="fas fa-times me-2"></i>Annuler le trajet
                </a>
              {% else %}
                <button class="btn btn-secondary d-block mb-3" disabled>
                  <i class="fas fa-info-circle me-2"></i>Trajet {{ selectedCarpool.statut }}
                </button>
              {% endif %}
              
            {% elseif selectedCarpool.passengers.contains(app.user) %}
              <!-- Passager -->
              <button class="btn btn-success d-block mb-3" disabled>
                <i class="fas fa-check me-2"></i>Vous participez à ce trajet
              </button>
              
            {% elseif selectedCarpool.statut == 'actif' and selectedCarpool.passengers|length < selectedCarpool.nbrPlaces %}
              <!-- Peut rejoindre -->
              <a href="{{ path('app_covoiturage_join', {'id': selectedCarpool.idCarpool}) }}" class="btn btn-primary d-block mb-3">
                <i class="fas fa-user-plus me-2"></i>Rejoindre le trajet ({{ selectedCarpool.credits }} crédits)
              </a>
              
            {% else %}
              <!-- Complet ou inactif -->
              <button class="btn btn-secondary d-block mb-3" disabled>
                {% if selectedCarpool.statut != 'actif' %}
                  <i class="fas fa-ban me-2"></i>Trajet {{ selectedCarpool.statut }}
                {% else %}
                  <i class="fas fa-users-slash me-2"></i>Trajet complet
                {% endif %}
              </button>
            {% endif %}
            
          {% else %}
            <!-- Non connecté -->
            <a href="{{ path('app_login') }}" class="btn btn-primary d-block mb-3">
              <i class="fas fa-sign-in-alt me-2"></i>Connectez-vous pour participer
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>