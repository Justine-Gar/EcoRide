{% extends 'base.html.twig' %}

{% block title %}Mon Profil
{% endblock %}

{% block stylesheets %}
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
	<link rel="stylesheet" href="{{ asset('assets/css/pages/dashboard/profilUser.css') }}">


{% endblock %}

{% block body %}
<!--=============START MAIN============-->
	
	<main class="container profil">
		

		<div class="row">
			<!--------Colonne de gauche - Informations principales -->
			<section class="col-lg-4">
				<!-- Carte profil -->
				<div class="card mb-4">
					<div class="card-body text-center">
						<img src="{% if user.profilPicture %}{{ asset('uploads/profile_pictures/' ~ user.profilPicture) }}{% else %}{{ asset('assets/images/default-profile.png') }}{% endif %}" class="rounded-circle mb-3" alt="Photo de profil">
						<h5 class="mb-2">{{user.firstname}} {{user.name}}</h5>

						<!-- Badge de rôles -->
						<div class="mb-4 role-switch">
							<div>
								<p id="role-display">Rôle actuel : Conducteur</p>
							</div>
							<div class="flash-messages">
								<!-- Les messages flash seront insérés ici dynamiquement -->
							</div>
							<div class="switch-container conducteur-active">
								<div class="switch-background">
										<div class="bg-conducteur"></div>
										<div class="bg-passager"></div>
								</div>
								<div class="switch-options">
										<div class="option option-conducteur option-active" onclick="activateOption('conducteur')">
											<i class="fas fa-car"></i>
											Conducteur
										</div>
										<div class="option option-passager" onclick="activateOption('passager')">
											Passager
											<i class="fas fa-hand-paper"></i>
										</div>
								</div>
							</div>
						</div>

						<!-- Bouton en fonction du role -->
						<div class="mb-2 buttons-container">
							<button id="btn-recherche" class="btn btn-green" style="display: none;">Recherche covoiturage</button>
							<button id="btn-trajet" class="btn btn-green" data-bs-toggle="modal" data-bs-target="#createTripModal">Créer un trajet</button>
						</div>
					</div>
				</div>

				

			</section>

			<!---------Colonne de droite - Information Personelles-->
			<section class="col-lg-4">

				<div class="card mb-4">
					<div class="card-header">

						<h5 class="mb-0">
							<i class="fas fa-user me-2"></i>Informations personnelles</h5>

					</div>
					<div class="card-body">
						<div class="mb-3">
							<label class="text-muted d-block">Email</label>
							<div>{{ user.email}}</div>
						</div>
						<div class="mb-3">
							<label class="text-muted d-block">Téléphone</label>
							<div>{{ user.phoneNumber}}</div>
						</div>

						<button type="button" class="btn btn-blue mt-3" data-bs-toggle="modal" data-bs-target="#editProfileModal">
							<i class="fas fa-edit me-2"></i>Modifier le profil
						</button>
					</div>

					
				</div>

			</section>

			<!---------------Credits /-->
			<section class="col-lg-4">

				<div>
					<!--Affichage des crédits-->
					<div class="card mb-4">
						<div class="card-header">
							<h5 class="mb-0"><i class="far fa-credit-card me-2"></i>Crédits</h5>
						</div>
						<div class="card-body text-center">
							<h3 class="mb-0 text-success">
								{{ user.credits }}
								<small>crédits</small>
							</h3>
						</div>
					</div>

					<!--Affichage Note et distance(option)-->
					{% if user.rating is not null %}
					<div class="card mb-4">
						<div class="card-header">
							<h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Note</h5>
						</div>
						<div class="card-body">
							<div class="g-4">

								<!-- Note moyenne -->
								<div>
									<div class="card border-warning">
										<div class="card-body text-center">
											<h6 class="text-muted mb-2">Note moyenne</h6>
											<div class="text-warning h2 mb-0">
												{{ user.rating|number_format(1) }}
												<small class="text-muted">/5</small>
											</div>
										</div>
									</div>
								</div>

							</div>


						</div>
					</div>
					{% endif %}
				</div>
			</section>

			<!---------------Alert -->
			<section id="alert-container" class="mt-3">
					{% for label, messages in app.flashes %}
							{% for message in messages %}
									<div class="alert alert-{{ label == 'error' ? 'danger' : label }} alert-dismissible fade show" role="alert">
											{% if label == 'success' %}
													<i class="fas fa-check-circle me-2"></i>
											{% else %}
													<i class="fas fa-exclamation-circle me-2"></i>
											{% endif %}
											{{ message }}
											<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
									</div>
							{% endfor %}
					{% endfor %}
			</section>

			<!---------------ELEMENTS-->
			<section class="col-lg-12">

				<!-- Système d'onglets pour Desktop -->
				<div class="desktop-tabs">
					<ul class="nav nav-tabs" id="profileTabs" role="tablist">
						<li class="nav-item">
							<a class="nav-link active" id="reviews-tab" data-bs-toggle="tab" href="#reviews" role="tab">Avis</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" id="vehicles-tab" data-bs-toggle="tab" href="#vehicles" role="tab">Véhicules</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" id="preferences-tab" data-bs-toggle="tab" href="#preferences" role="tab">Préférences</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" id="trips-tab" data-bs-toggle="tab" href="#trips" role="tab">Trajets</a>
						</li>

					</ul>

					<div class="tab-content border-start border-end border-bottom p-2 mb-5" id="profileTabsContent">
						<!-- Contenu Avis -->
						<div class="tab-pane fade show active" id="reviews" role="tabpanel">
							<div class="card">
								<div class="card-header d-flex justify-content-between align-items-center">
									<h5 class="mb-0"><i class="fas fa-star me-2"></i>Avis reçus</h5>
									<div class="dropdown">
										<button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
											Filtrer
										</button>
										<ul class="dropdown-menu">
											<li>
												<a class="dropdown-item" href="#">Tous les avis</a>
											</li>
											<li>
												<a class="dropdown-item" href="#">En tant que conducteur</a>
											</li>
											<li>
												<a class="dropdown-item" href="#">En tant que passager</a>
											</li>
										</ul>
									</div>
								</div>
								<div class="card-body">
									{% if user.recipientReviews|length > 0 %}
											{% for review in user.recipientReviews %}
													{% if review.statut == 'publié' %}
															<!-- Avis individuel -->
															<div class="border-bottom pb-3 mb-3 review-item" 
																	data-role="{% if review.carpool.user.idUser == user.idUser %}driver{% else %}passenger{% endif %}">
																	<div class="d-flex justify-content-between align-items-start mb-2">
																			<div class="d-flex align-items-center">
																					<img src="{% if review.sender.profilPicture %}{{ asset('uploads/profile_pictures/' ~ review.sender.profilPicture) }}{% else %}{{ asset('assets/images/default-profile.png') }}{% endif %}" 
																							class="rounded-circle me-2" alt="Avatar" style="width: 40px; height: 40px;">
																					<div>
																							<h6 class="mb-0">{{ review.sender.firstname }} {{ review.sender.name }}</h6>
																							<small class="text-muted">
																									Trajet {{ review.carpool.locationStart }} → {{ review.carpool.locationReach }}, 
																									{{ review.carpool.dateStart|date('d M Y') }}
																							</small>
																					</div>
																			</div>
																			<div class="text-warning">
																					{% set rating = review.note|number_format(1) %}
																					{% for i in 1..5 %}
																							{% if i <= rating %}★{% else %}☆{% endif %}
																					{% endfor %}
																					<span class="text-dark ms-1">{{ rating }}</span>
																			</div>
																	</div>
																	<p class="mb-1">{{ review.comment }}</p>
																	<div class="d-flex align-items-center">
																			{% if review.carpool.user.idUser == user.idUser %}
																					<span class="badge bg-success me-2">Conducteur</span>
																			{% else %}
																					<span class="badge bg-info me-2">Passager</span>
																			{% endif %}
																			<small class="text-muted">Vérifié par la modération</small>
																	</div>
															</div>
													{% endif %}
											{% endfor %}
									{% else %}
											<div class="text-center py-4">
													<i class="far fa-comment-alt fa-3x mb-3 text-muted"></i>
													<p>Aucun avis reçu pour le moment</p>
											</div>
									{% endif %}
								</div>
							</div>
							<!-- Pagination -->
							{% if user.recipientReviews|length > 5 %}
							<nav aria-label="Page navigation" class="mt-4">
								<ul class="pagination justify-content-center">
									<li class="page-item disabled">
										<a class="page-link" href="#" tabindex="-1">Précédent</a>
									</li>
									<li class="page-item active">
										<a class="page-link" href="#">1</a>
									</li>
									<li class="page-item">
										<a class="page-link" href="#">2</a>
									</li>
									<li class="page-item">
										<a class="page-link" href="#">3</a>
									</li>
									<li class="page-item">
										<a class="page-link" href="#">Suivant</a>
									</li>
								</ul>
							</nav>
							{% endif %}
						</div>

						<!-- Contenu Véhicules -->
						<div class="tab-pane fade" id="vehicles" role="tabpanel">
							<div class="card">

                <!-- CARD CAR-->
								<div class="card-header d-flex justify-content-between align-items-center">
									<h5 class="mb-0">
										<i class="fas fa-car me-2"></i>Mes véhicules</h5>
									<button class="btn btn-green" data-bs-toggle="modal" data-bs-target="#addVehicleModal">
										<i class="fas fa-plus me-2"></i>Ajouter un véhicule</button>
								</div>
								<div class="card-body">
									<!-- Contenu des véhicules -->
                  {% for car in cars %}
                    <div class="vehicle-cards p-3 border rounded mb-3">
                      <div class="d-flex justify-content-between">
                        <div>
                          <h6 class="mb-1">{{ car.marque }} {{ car.modele }}</h6>
                          <p class="text-muted mb-1">{{ car.color }} • {{ car.nbrPlaces() }} places</p>
                          <small class="text-muted">Immatriculation: {{ car.licensePlate }}</small>
                          <small class="text-muted">Première immatriculation: {{ car.firstRegistration|date('d/m/Y') }}</small>
                        </div>
                        <div class="text-end">
                          <span class="badge bg-success mb-2">{{ car.energie }}</span>
                          <div>
                            <form action="{{ path('app_profile_delete_car', { 'id': car.id }) }}" method="post" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce véhicule ?');">
                                <input type="hidden" name="_method" value="DELETE">
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                  {% endfor %}
								</div>
							</div>
						</div>

						<!-- Contenu Préférences -->
						<div class="tab-pane fade" id="preferences" role="tabpanel">
							<div class="card">
								<div class="card-header d-flex justify-content-between align-items-center">
									<h5 class="mb-0">
										<i class="fas fa-cog me-2"></i>Mes préférences</h5>
									<button class="btn btn-green" data-bs-toggle="modal" data-bs-target="#addPreferenceModal">
										<i class="fas fa-plus me-2"></i>Ajouter une préférences
									</button>
								</div>

								<div class="card-body">
									<!-- Préférences système -->
									<div class="mb-4">
										<h6 class="fw-bold mb-3">Préférences système</h6>
										<div class="form-check mb-2">
											<input class="form-check-input" type="checkbox" id="smokingAllowed">
											<label class="form-check-label" for="smokingAllowed">
												Accepte les fumeurs (pauses)
											</label>
										</div>
										<div class="form-check">
											<input class="form-check-input" type="checkbox" id="petsAllowed">
											<label class="form-check-label" for="petsAllowed">
												Accepte les animaux
											</label>
										</div>
									</div>
									<!-- Préférences utilisateur -->
									<div class="mb-4">
										<h6 class="fw-bold mb-3">Préférences de (nom de l'utilisateur)</h6>
									</div>
								</div>

							</div>


						</div>

						<!-- Contenu Trajets -->
						<div class="tab-pane fade" id="trips" role="tabpanel">
							<!-- Contenu des trajets -->
							<div class="card">
								<div class="card-header d-flex justify-content-between align-items-center">
									<h5 class="mb-0"><i class="fas fa-route me-2"></i>Mes trajets</h5>
									<div class="dropdown">
										<button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
											Filtrer
										</button>
										<ul class="dropdown-menu">
											<li>
												<a class="dropdown-item" href="#" data-filter="all">Tous les trajets</a>
											</li>
											<li>
												<a class="dropdown-item" href="#" data-filter="driver">En tant que conducteur</a>
											</li>
											<li>
												<a class="dropdown-item" href="#" data-filter="passenger">En tant que passager</a>
											</li>
										</ul>
									</div>
								</div>

								<div class="card-body">
									<!--TRAJET EN COURS-->
									<div class="mb-4">
										<h6 class="mb-3 text-muted">Trajets en cours</h6>
										{% if waitingCarpoolsAsDriver|length == 0 and activeCarpoolsAsDriver|length == 0 and waitingCarpoolsAsPassenger|length == 0 and activeCarpoolsAsPassenger|length == 0 %}
												<div class="alert alert-info">
														<i class="fas fa-info-circle me-2"></i>Vous n'avez pas de trajet en cours
												</div>
										{% else %}
												<!-- Trajets en tant que conducteur -->
												{% if waitingCarpoolsAsDriver|length > 0 or activeCarpoolsAsDriver|length > 0 %}
														<h6 class="mt-3 mb-2"><i class="fas fa-car me-2"></i>En tant que conducteur</h6>
														
														<!-- Trajets en attente conducteur -->
														{% for carpool in waitingCarpoolsAsDriver %}
																<div class="card mb-3 driver-carpool">
																		<div class="card-body">
																				<div class="d-flex justify-content-between align-items-start">
																						<div>
																								<span class="badge badge-driver mb-2">Conducteur</span>
																								<span class="badge bg-warning text-dark mb-2 ms-2">En attente</span>
																								<h5 class="mb-1">{{ carpool.getLocationStart() }} -> {{ carpool.getLocationReach() }}</h5>
																								<p class="text-muted mb-2">
																										<i class="fas fa-calendar me-2"></i>{{ carpool.getDateStart()|date('d/m/Y') }}
																										<i class="fas fa-clock ms-3 me-2"></i>{{ carpool.getHourStart()|date('H:i') }} - {{ carpool.getHourReach()|date('H:i') }}
																								</p>
																								<p class="text-muted mb-2">
																										<i class="fas fa-users me-2"></i>{{ carpool.getPassengers()|length }}/{{ carpool.getNbrPlaces() }} passagers
																										<i class="fas fa-coins ms-3 me-2"></i>{{ carpool.getCredits() }} crédits
																								</p>
																						</div>
																						<div class="text-end">
																								<a href="{{ path('app_covoiturage_start', {'id': carpool.getIdCarpool() }) }}" class="btn btn-green mb-2">
																										Départ
																								</a>
																								<a href="{{ path('app_covoiturage_cancel', {'id': carpool.getIdCarpool() }) }}" class="btn btn-outline-danger mb-2" onclick="return confirm('Êtes-vous sûr de vouloir annuler ce trajet ?')">
																										Annuler
																								</a>
																						</div>
																				</div>
																		</div>
																</div>
														{% endfor %}
														
														<!-- Trajets actifs conducteur -->
														{% for carpool in activeCarpoolsAsDriver %}
																<div class="card mb-3 driver-carpool">
																		<div class="card-body">
																				<div class="d-flex justify-content-between align-items-start">
																						<div>
																								<span class="badge badge-driver mb-2">Conducteur</span>
																								<span class="badge bg-success text-white mb-2 ms-2">En cours</span>
																								<h5 class="mb-1">{{ carpool.getLocationStart() }} -> {{ carpool.getLocationReach() }}</h5>
																								<p class="text-muted mb-2">
																										<i class="fas fa-calendar me-2"></i>{{ carpool.getDateStart()|date('d/m/Y') }}
																										<i class="fas fa-clock ms-3 me-2"></i>{{ carpool.getHourStart()|date('H:i') }} - {{ carpool.getHourReach()|date('H:i') }}
																								</p>
																								<p class="text-muted mb-2">
																										<i class="fas fa-users me-2"></i>{{ carpool.getPassengers()|length }}/{{ carpool.getNbrPlaces() }} passagers
																										<i class="fas fa-coins ms-3 me-2"></i>{{ carpool.getCredits() }} crédits
																								</p>
																						</div>
																						<div class="text-end">
																								<a href="{{ path('app_covoiturage_finish', {'id': carpool.getIdCarpool() }) }}" class="btn btn-green mb-2">
																										Arrivée
																								</a>
																								<a href="{{ path('app_covoiturage_cancel', {'id': carpool.getIdCarpool() }) }}" class="btn btn-outline-danger mb-2" onclick="return confirm('Êtes-vous sûr de vouloir annuler ce trajet ?')">
																										Annuler
																								</a>
																						</div>
																				</div>
																		</div>
																</div>
														{% endfor %}
												{% endif %}
												
												<!-- Trajets en tant que passager -->
												{% if waitingCarpoolsAsPassenger|length > 0 or activeCarpoolsAsPassenger|length > 0 %}
														<h6 class="mt-3 mb-2"><i class="fas fa-user me-2"></i>En tant que passager</h6>
														
														<!-- Trajets en attente passager -->
														{% for carpool in waitingCarpoolsAsPassenger %}
																<div class="card mb-3 passenger-carpool">
																		<div class="card-body">
																				<div class="d-flex justify-content-between align-items-start">
																						<div>
																								<span class="badge badge-passenger mb-2">Passager</span>
																								<span class="badge bg-warning text-dark mb-2 ms-2">En attente</span>
																								<h5 class="mb-1">{{ carpool.getLocationStart() }} → {{ carpool.getLocationReach() }}</h5>
																								<p class="text-muted mb-2">
																										<i class="fas fa-calendar me-2"></i>{{ carpool.getDateStart()|date('d/m/Y') }}
																										<i class="fas fa-clock ms-3 me-2"></i>{{ carpool.getHourStart()|date('H:i') }} - {{ carpool.getHourReach()|date('H:i') }}
																								</p>
																								<p class="text-muted mb-2">
																										<i class="fas fa-user me-2"></i>Conducteur: {{ carpool.getUser().getFirstname() }} {{ carpool.getUser().getName() }}
																										<i class="fas fa-coins ms-3 me-2"></i>{{ carpool.getCredits() }} crédits
																								</p>
																						</div>
																						<div class="text-end">
																								<a href="{{ path('app_covoiturage', {'id': carpool.getIdCarpool() }) }}" class="btn btn-outline-primary">
																										<i class="fas fa-info-circle me-2"></i>Détails
																								</a>
																						</div>
																				</div>
																		</div>
																</div>
														{% endfor %}
														
														<!-- Trajets actifs passager -->
														{% for carpool in activeCarpoolsAsPassenger %}
																<div class="card mb-3 passenger-carpool">
																		<div class="card-body">
																				<div class="d-flex justify-content-between align-items-start">
																						<div>
																								<span class="badge badge-passenger mb-2">Passager</span>
																								<span class="badge bg-success text-white mb-2 ms-2">En cours</span>
																								<h5 class="mb-1">{{ carpool.getLocationStart() }} → {{ carpool.getLocationReach() }}</h5>
																								<p class="text-muted mb-2">
																										<i class="fas fa-calendar me-2"></i>{{ carpool.getDateStart()|date('d/m/Y') }}
																										<i class="fas fa-clock ms-3 me-2"></i>{{ carpool.getHourStart()|date('H:i') }} - {{ carpool.getHourReach()|date('H:i') }}
																								</p>
																								<p class="text-muted mb-2">
																										<i class="fas fa-user me-2"></i>Conducteur: {{ carpool.getUser().getFirstname() }} {{ carpool.getUser().getName() }}
																										<i class="fas fa-coins ms-3 me-2"></i>{{ carpool.getCredits() }} crédits
																								</p>
																						</div>
																						<div class="text-end">
																								<a href="{{ path('app_covoiturage', {'id': carpool.getIdCarpool() }) }}" class="btn btn-outline-primary">
																										<i class="fas fa-info-circle me-2"></i>Détails
																								</a>
																						</div>
																				</div>
																		</div>
																</div>
														{% endfor %}
												{% endif %}
										{% endif %}
								</div>


									<!--TRAJET TERMINES-->
									<div>
										<h6 class="mb-3 text-muted">Trajets terminés</h6>

										{% if completedCarpoolsAsDriver|length == 0 and completedCarpoolsAsPassenger|length == 0 %}
											<div class="alert alert-info">
													<i class="fas fa-info-circle me-2"></i>Vous n'avez pas de trajet terminé
											</div>
                		{% else %}
											<!-- Trajet terminé conducteur -->
											{% for carpool in completedCarpoolsAsDriver %}
												<div class="card mb-3 driver-carpool">
													<div class="card-body">
														<div class="d-flex justify-content-between align-items-start">
															<div>
																<span class="badge badge-driver mb-2">Conducteur</span>
																<h5 class="mb-1">{{ carpool.getLocationStart() }} -> {{ carpool.getLocationReach() }}</h5>
																<p class="text-muted mb-2">
																	<i class="fas fa-calendar me-2"></i>{{ carpool.getDateStart()|date('d/m/Y') }}
																	<i class="fas fa-check-circle ms-3 me-2"></i>Terminé
																</p>
																<div class="d-flex align-items-center">
                                    <small class="text-muted">Aucun avis</small>
																</div>
															</div>
															<div class="text-end">
																<a href="{{ path('app_covoiturage', {'id': carpool.getIdCarpool() }) }}" class="btn btn-outline-primary">
                                  <i class="fas fa-info-circle me-2"></i>Détails
                                </a>
															</div>
														</div>
													</div>
												</div>
											{% endfor %}

											<!-- Trajhet terminé passager-->
											{% for carpool in completedCarpoolsAsPassenger %}
                        <div class="card mb-3 passenger-carpool">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <span class="badge badge-passenger mb-2">Passager</span>
                                        <h5 class="mb-1">{{ carpool.getLocationStart() }} -> {{ carpool.getLocationReach() }}</h5>
                                        <p class="text-muted mb-2">
                                            <i class="fas fa-calendar me-2"></i>{{ carpool.getDateStart()|date('d/m/Y') }}
                                            <i class="fas fa-check-circle ms-3 me-2"></i>Terminé
                                        </p>
                                        <p class="text-muted mb-2">
                                            <i class="fas fa-user me-2"></i>Conducteur: {{ carpool.getUser().getFirstname() }} {{ carpool.getUser().getName() }}
                                            <i class="fas fa-coins ms-3 me-2"></i>{{ carpool.getCredits() }} crédits
                                        </p>
                                        
                                        {% set hasReviewed = false %}
                                        {% if user.getSenderReviews() is defined %}
                                            {% for review in user.getSenderReviews() %}
                                                {% if review.getCarpool() and review.getCarpool().getIdCarpool() == carpool.getIdCarpool() %}
                                                    {% set hasReviewed = true %}
                                                {% endif %}
                                            {% endfor %}
                                        {% endif %}
                                        
                                        {% if not hasReviewed %}
                                            <div class="mt-2">
                                                <a href="{{ path('app_review_add', {'carpoolId': carpool.getIdCarpool()}) }}" class="btn btn-sm btn-outline-warning">
                                                    <i class="fas fa-star me-2"></i>Laisser un avis
                                                </a>
                                            </div>
                                        {% else %}
                                            <div class="badge bg-light text-dark">
                                                <i class="fas fa-check me-1"></i>Avis déjà envoyé
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="text-end">
                                        <a href="{{ path('app_covoiturage', {'id': carpool.getIdCarpool() }) }}" class="btn btn-outline-primary">
                                            <i class="fas fa-info-circle me-2"></i>Détails
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    	{% endfor %}
										{% endif %}
									</div>
								</div>

							</div>
						</div>
					</div>

				</div>


				<!--Cards pour mobile-->
				<div class="mobile-cards">
					<!-- Card Avis -->
					<div class="card mb-4">
						<div class="card-header d-flex justify-content-between align-items-center">
							<h5 class="mb-0">
								<i class="fas fa-star me-2"></i>Avis reçus</h5>
							<div class="dropdown">
								<button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
									Filtrer
								</button>
								<ul class="dropdown-menu">
									<li>
										<a class="dropdown-item" href="#">Tous les avis</a>
									</li>
									<li>
										<a class="dropdown-item" href="#">En tant que conducteur</a>
									</li>
									<li>
										<a class="dropdown-item" href="#">En tant que passager</a>
									</li>
								</ul>
								<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#avisCollapse">
									<i class="fas fa-chevron-down"></i>
								</button>
							</div>
						</div>
						<div class="collapse" id="avisCollapse">
							<div
								class="card-body">
								<!-- Avis individuel -->
								<div class="border-bottom pb-3 mb-3">
									<div class="d-flex justify-content-between align-items-start mb-2">
										<div class="d-flex align-items-center">
											<img src="" class="rounded-circle me-2" alt="Avatar">
											<div>
												<h6 class="mb-0">Pierre Dubois</h6>
												<small class="text-muted">Trajet Paris → Lyon, 15 jan. 2025</small>
											</div>
										</div>
										<div class="text-warning">
											★★★★★
											<span class="text-dark ms-1">5.0</span>
										</div>
									</div>
									<p class="mb-1">Conductrice très ponctuelle et sympathique. Voiture propre et confortable. Discussion agréable pendant le trajet !</p>
									<div class="d-flex align-items-center">
										<span class="badge bg-success me-2">Conducteur</span>
										<small class="text-muted">Vérifié par la modération</small>
									</div>
								</div>

								<!-- Autre avis -->
								<div class="border-bottom pb-3 mb-3">
									<div class="d-flex justify-content-between align-items-start mb-2">
										<div class="d-flex align-items-center">
											<img src="" class="rounded-circle me-2" alt="Avatar">
											<div>
												<h6 class="mb-0">Marie Lambert</h6>
												<small class="text-muted">Trajet Lyon → Marseille, 5 jan. 2025</small>
											</div>
										</div>
										<div class="text-warning">
											★★★★☆
											<span class="text-dark ms-1">4.0</span>
										</div>
									</div>
									<p class="mb-1">Bonne communication et respect des horaires. Sophie est une passagère agréable.</p>
									<div class="d-flex align-items-center">
										<span class="badge bg-info me-2">Passager</span>
										<small class="text-muted">Vérifié par la modération</small>
									</div>
								</div>

								<!-- Pagination -->
								<nav aria-label="Page navigation" class="mt-4">
									<ul class="pagination justify-content-center">
										<li class="page-item disabled">
											<a class="page-link" href="#" tabindex="-1">Précédent</a>
										</li>
										<li class="page-item active">
											<a class="page-link" href="#">1</a>
										</li>
										<li class="page-item">
											<a class="page-link" href="#">2</a>
										</li>
										<li class="page-item">
											<a class="page-link" href="#">3</a>
										</li>
										<li class="page-item">
											<a class="page-link" href="#">Suivant</a>
										</li>
									</ul>
								</nav>
							</div>
						</div>
					</div>

					<!-- Card Véhicules -->
					<div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-car me-2"></i>Mes véhicules
                </h5>
                <div class="d-flex align-items-center">
                    <!-- Bouton pour ajouter un véhicule -->
                    <button class="btn btn-sm btn-green me-2" data-bs-toggle="modal" data-bs-target="#addVehicleModal">
                        <i class="fas fa-plus"></i>
                    </button>
                    <!-- Bouton pour afficher/masquer la section -->
                    <button class="btn btn-sm btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#vehiclesCollapse">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
            </div>
            <div class="collapse" id="vehiclesCollapse">
                <div class="card-body">
                    <!-- Contenu des véhicules -->
                    {% if cars is empty %}
                        <p class="text-muted text-center">Aucun véhicule enregistré</p>
                    {% else %}
                        {% for car in cars %}
                            <div class="vehicle-card p-3 border rounded mb-3">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="mb-1">{{ car.marque }} {{ car.modele }}</h6>
                                        <p class="text-muted mb-1">{{ car.color }} • {{ car.nbrPlaces }} places</p>
                                        <small class="text-muted d-block">Immatriculation: {{ car.licensePlate }}</small>
                                        <small class="text-muted d-block">Première immatriculation: {{ car.firstRegistration|date('d/m/Y') }}</small>
                                    </div>
                                    <div class="text-end">
                                        <span class="badge bg-success mb-2">{{ car.energie }}</span>
                                        <div>
                                            <form action="{{ path('app_profile_delete_car', { 'id': car.id }) }}" 
                                                  method="post" 
                                                  onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce véhicule ?');"
                                                  class="d-inline">
                                                <input type="hidden" name="_method" value="DELETE">
                                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
          </div>

					<!-- Card Préférences -->
					<div class="card mb-4">
						<div class="card-header d-flex justify-content-between align-items-center">
							<h5 class="mb-0">
								<i class="fas fa-cog me-2"></i>Mes préférences</h5>
							<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#preferencesCollapse">
								<i class="fas fa-chevron-down"></i>
							</button>
						</div>
						<div class="collapse" id="preferencesCollapse">
							<div
								class="card-body">
								<!-- Contenu des préférences -->
								<div class="card mb-4">
									<div class="card-body">
										<div class="mb-3">
											<label class="form-label">Musique pendant le trajet</label>
											<div class="form-check">
												<input class="form-check-input" type="checkbox" checked>
												<label class="form-check-label">Accepte la musique</label>
											</div>
										</div>
										<div class="mb-3">
											<label class="form-label">Discussion</label>
											<div class="form-check">
												<input class="form-check-input" type="checkbox" checked>
												<label class="form-check-label">Aime discuter pendant le trajet</label>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Card Trajets -->
					<div class="card mb-4">
						<div class="card-header d-flex justify-content-between align-items-center">
							<h5 class="mb-0">
								<i class="fas fa-route me-2"></i>Mes trajets</h5>
							<div class="dropdown">
								<button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
									Filtrer
								</button>
								<ul class="dropdown-menu">
									<li>
										<a class="dropdown-item" href="#">Tous les trajets</a>
									</li>
									<li>
										<a class="dropdown-item" href="#">En tant que conducteur</a>
									</li>
									<li>
										<a class="dropdown-item" href="#">En tant que passager</a>
									</li>
								</ul>
								<button class="btn btn-sm btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#tripsCollapse">
									<i class="fas fa-chevron-down"></i>
								</button>
							</div>
						</div>
						<div class="collapse" id="tripsCollapse">
							<div
								class="card-body ">
								<!-- Contenu des trajets -->
								<div
									class="accordion" id="tripsAccordion">
									<!--Trajet en cours-->
									<div class="accordion-item">
										<h2 class="accordion-header">
											<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ongoingTrips">
												Trajets en cours (1)
											</button>
										</h2>
										<div id="ongoingTrips" class="accordion-collapse collapse">
											<div class="accordion-body p-2">
												<div class="mb-4">

													<div class="card mb-2 border-primary">
														<div class="card-body">
															<div class="d-flex justify-content-between align-items-start">
																<div>
																	<span class="badge bg-success mb-2">Conducteur</span>
																	<h5 class="mb-1">Bordeaux → Toulouse</h5>
																	<p class="text-muted mb-2">
																		<i class="fas fa-calendar me-2"></i>Aujourd'hui
																		<i class="fas fa-clock ms-3 me-2"></i>En cours
																	</p>

																</div>
																<div class="text-end">
																	<button class="btn btn-success mb-2">
																		<i class="fas fa-flag-checkered me-2"></i>Arrivée
																	</button>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>

									<!--Trajet terminés-->
									<div class="accordion-item">
										<h2 class="accordion-header">
											<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#completedTrips">
												Trajets terminés
											</button>
										</h2>
										<div id="completedTrips" class="accordion-collapse collapse">
											<div class="accordion-body p-2">
												<div class="card mb-3">
													<div class="card-body">
														<div class="d-flex justify-content-between align-items-start">
															<div>
																<span class="badge bg-success mb-2">Conducteur</span>
																<h5 class="mb-1">Nice → Cannes</h5>
																<p class="text-muted mb-2">
																	<i class="fas fa-calendar me-2"></i>10 février 2025
																	<i class="fas fa-check-circle ms-3 me-2"></i>Terminé
																</p>
																<div class="d-flex align-items-center">
																	<div class="text-warning me-2">
																		★★★★★
																	</div>
																	<small class="text-muted">(4 avis)</small>
																</div>
															</div>
															<div class="text-end">
																<button class="btn btn-outline-primary">Voir les avis</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>

								</div>

							</div>
						</div>
					</div>
				</div>


			</section>

		</div>

	</main>

	{% include 'partials/modals/profile_modals.html.twig' with {'form': form, 'carForm': carForm, 'user': user} %}
	{% include 'partials/modals/trip_modals.html.twig' with {'cars': cars is defined ? cars : []} %}
	
{% endblock %}

{% block javascripts %}
    {{ parent() }}
		<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="{{ asset('assets/js/profile.js') }}"></script>
		<script src="{{ asset('assets/js/btnSwitch.js') }}"></script>
		<script src="{{ asset('assets/js/addCarpool.js') }}"></script>
{% endblock %}
