{% extends 'base.html.twig' %}

{% block title %}Mon Profil
{% endblock %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('assets/css/pages/dashboard/profilUser.css') }}">


{% endblock %}

{% block body %}
<!--=============START MAIN============-->
	<main class="container profil-staff">
		<div class="row">
			<!-- Sidebar -->
      {% block Sidebar %}
        {% include 'partials/sidebar/_sidebar_staff.html.twig' %}
      {% endblock %}
			<!-- Main Dashboard -->
			<div class="col-md-9 mb-5">
				<!-- Flash messages -->
				{% for label, messages in app.flashes %}
						{% for message in messages %}
								<div class="alert alert-{{ label }} alert-dismissible fade show" role="alert">
										{{ message }}
										<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
								</div>
						{% endfor %}
				{% endfor %}

				<!-- Stats Cards -->
				<div class="row mb-4">
					<div class="col-md-4">
						<div class="card bg-primary text-white">
							<div class="card-body">
								<h6 class="card-title">
									<i class="fas fa-comments me-1"></i>Avis en attente
								</h6>
								<h2 class="card-text">{{ pendingCount }}</h2>
							</div>
						</div>
					</div>
					<div class="col-md-4">
						<div class="card bg-warning text-white">
							<div class="card-body">
								<h6 class="card-title">
									<i class="fas fa-exclamation-triangle me-1"></i>Signalements
								</h6>
								<h2 class="card-text">{{ reportedCount }}</h2>
							</div>
						</div>
					</div>
					<div class="col-md-4">
						<div class="card bg-success text-white">
							<div class="card-body">
								<h6 class="card-title">
									<i class="fas fa-check-circle me-1"></i>Avis traités
								</h6>
								<h2 class="card-text">{{ processedCount }}</h2>
							</div>
						</div>
					</div>
				</div>

				<!-- Reviews Section -->
				<div class="card mb-4">
					<div class="card-header bg-light">
						<h5 class="mb-0">
							<i class="fas fa-star me-1"></i>Avis à modérer
						</h5>
					</div>
					<div class="card-body">
						{% if pendingReviews is empty %}
							<div class="text-center text-muted py-3">
								<i class="fas fa-check-circle fa-2x mb-2"></i>
								<p>Aucun avis en attente de modération</p>
							</div>
						{% else %}
							<div class="table-responsive">
								<table class="table">
									<thead>
										<tr>
											<th>Date</th>
											<th>Passager</th>
											<th>Conducteur</th>
											<th>Note</th>
											<th>Commentaire</th>
											<th>Actions</th>
										</tr>
									</thead>
									<tbody>
										{% for review in pendingReviews %}
											<tr>
												<td>{{ review.carpool.dateStart|date('d/m/Y') }}</td>
												<td>{{ review.sender.firstname }} {{ review.sender.name|first }}</td>
												<td>{{ review.recipient.firstname }} {{ review.recipient.name|first }}.</td>
												<td>{{ review.note }}</td>
												<td>{{ review.comment|length > 50 ? review.comment|slice(0, 50) ~ '...' : review.comment }}</td>
												<td>
													<form method="post" action="{{ path('app_staff_approve_review', {'id': review.idReview}) }}" class="d-inline js-review-form">
														<button type="submit" class="btn btn-success btn-sm">
																<i class="fas fa-check"></i>
														</button>
													</form>
													<form method="post" action="{{ path('app_staff_reject_review', {'id': review.idReview}) }}" class="d-inline js-review-form">
														<button type="submit" class="btn btn-danger btn-sm">
																<i class="fas fa-times"></i>
														</button>
													</form>
													<button type="button" class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#reviewModal{{ review.idReview }}">
														<i class="fas fa-eye"></i>
													</button>
												</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
						{% endif %}
					</div>
				</div>

				<!-- Issues Section - Section à développer lorsque le système de signalements sera en place -->
				<div class="card">
					<div class="card-header bg-light">
						<h5 class="mb-0">
							<i class="fas fa-exclamation-circle me-1"></i>Covoiturages signalés
						</h5>
					</div>
					<div class="card-body">
						<!-- Pour le moment, afficher un message indiquant que cette fonctionnalité sera disponible prochainement -->
						<div class="text-center text-muted py-3">
							<i class="fas fa-tools fa-2x mb-2"></i>
							<p>Cette fonctionnalité sera disponible prochainement</p>
						</div>
						<!-- Quand le système de signalements sera prêt, décommenter et adapter ce code
														<div class="table-responsive">
																<table class="table">
																		<thead>
																				<tr>
																						<th>N° Covoiturage</th>
																						<th>Date</th>
																						<th>Trajet</th>
																						<th>Participants</th>
																						<th>Statut</th>
																						<th>Actions</th>
																				</tr>
																		</thead>
																		<tbody>
																				<tr>
																						<td>#12345</td>
																						<td>14/02/2024</td>
																						<td>Paris → Lyon</td>
																						<td>
																								<button class="btn btn-link btn-sm p-0" data-bs-toggle="tooltip" title="pierre@email.com">Pierre D.</button>
																								<span class="text-muted">→</span>
																								<button class="btn btn-link btn-sm p-0" data-bs-toggle="tooltip" title="sophie@email.com">Sophie M.</button>
																						</td>
																						<td>
																								<span class="badge bg-danger">Non résolu</span>
																						</td>
																						<td>
																								<div class="btn-group">
																										<button class="btn btn-info btn-sm" data-bs-toggle="tooltip" title="Voir les détails">
																												<i class="fas fa-eye"></i>
																										</button>
																										<button class="btn btn-warning btn-sm" data-bs-toggle="tooltip" title="Contacter les participants">
																												<i class="fas fa-envelope"></i>
																										</button>
																										<button class="btn btn-success btn-sm" data-bs-toggle="tooltip" title="Marquer comme résolu">
																												<i class="fas fa-check"></i>
																										</button>
																										<button class="btn btn-danger btn-sm" data-bs-toggle="tooltip" title="Signaler à l'administration">
																												<i class="fas fa-exclamation-triangle"></i>
																										</button>
																								</div>
																						</td>
																				</tr>
																		</tbody>
																</table>
														</div>
														-->
					</div>
				</div>
			</div>
		</div>
	</main>

{% endblock %}
